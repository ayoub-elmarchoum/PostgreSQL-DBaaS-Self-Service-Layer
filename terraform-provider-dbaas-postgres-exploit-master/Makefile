GOFMT_FILES?=$$(find . -name '*.go' |grep -v vendor)
VERSION ?= v1.1.3

default: build

build: fmtcheck
	go build -v .

lint:
	# golangci-lint run
	echo "golangci-lint disabled"

clean:
	rm -rf ./build ./dist

security:
	# gosec -exclude-dir _local -quiet ./...
	echo "gosec disabled"

fmt:
	gofmt -w $(GOFMT_FILES)

fmtcheck:
	@sh -c "'$(CURDIR)/scripts/gofmtcheck.sh'"

tidy:
	go mod tidy

test:
	# go test -v -cover -timeout=120s -parallel=4 ./...
	echo "test disabled"

testacc:
	tcping localhost 5432
	TF_ACC=1 go test -v -cover -timeout 120m ./...

run:
	find /tmp -type s -name "plugin*" -delete 2>/dev/null || echo
	go run main.go -debug

release:
	goreleaser release --skip=announce,publish,validate --clean 
publish:
	artifactory-helper upload local-genesis-terraform-providers dist/terraform-provider-dbaas-postgres-exploit_$${CI_COMMIT_REF_NAME:1}_linux_amd64.zip ingenico/dbaas-postgres-exploit/$${CI_COMMIT_REF_NAME:1}

